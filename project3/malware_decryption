import os
import subprocess

# Code written by Jason Quiroga and Katie Hopkins for SEC-440

# Decrypt the symmetric key from disk
smem = os.system("openssl pkeyutl -decrypt -in smem-enc.enc -out smem.unenc -inkey private.pem")
os.remove("smem-unenc.enc")
os.system("echo {} > smem.enc".format(smem))

# List of targets to be decrypted
targets = ["secret1.txt", "secret2.txt", "secret3.txt"]

# Decrypt the target files using OpenSSL
for target in targets:
    if os.path.exists(target):
        target_without_ext = os.path.splitext(target)[0]
        subprocess.run("openssl aes-256-cbc -d -in {} -out {} -pass file:smem.unenc".format(target, target_without_ext), shell=True)
        os.remove(target)
os.remove("smem.unenc")
os.remove("smem.enc")
